<h3 class="mdc-typography--headline3">Random Location</h3>
<p>Click the Find button to get a random Location to go to!</p>
<p>Click Save to store the marker of the location shown, if you are interested in going for a visit!</p>
<div>
    <button id="location" class="button">Find me a spot!</button>
    <button id="Save" class="button">Save it!</button>
</div>

<div id="map" style="width:100%;height:400px;"></div>
<div id="pano" style="width:100%;height:400px;"></div>

<script>
var latN;
var lngN;
var panorama;
var map;
var locN;
    
var db = new Dexie("Marker_Database");
    db.version(2).stores({
        Markers: 'lt, lg'
    });
    
$('#location').on('click', function() {
    initMap();
});
    

$('#Save').on('click', function() {
//     console.log("Lat: " + latN);
//     console.log("Log: " + lngN);
    db.Markers.put({lt:latN, lg:lngN});
});
    
    
function initMap() {
    var sv = new google.maps.StreetViewService;
    
    latN = Math.floor((Math.random()*(85*2)-85));
    lngN = Math.floor((Math.random()*(180*2)-180));
    locN = {lat: latN, lng: lngN};

    sv.getPanorama({location: locN, radius: 10000000}, processSVData);
}
    
function processSVData(data, status){
    if (status === 'OK'){
        locN = data.location.latLng;
        latN = Number(locN.lat());
        lngN = Number(locN.lng());
//         console.log("Lat: " + latN);
//         console.log("Log: " + lngN);
        var mapProp= {center: locN, zoom:16};
        map = new google.maps.Map(document.getElementById('map'),mapProp);
        var marker = new google.maps.Marker({position: locN, map: map});
        panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'), {motionTrackingControlOptions: {
        position: google.maps.ControlPosition.LEFT_BOTTOM}});
        panorama.setPano(data.location.pano);
        panorama.setPov({ heading: 34, pitch: 10});
        panorama.setVisible(true);
        
        db.Markers.each(function(marker){
            var loc = new google.maps.LatLng(marker.lt,marker.lg);
            var marker = new google.maps.Marker({position: loc, map: map});
        });
    } else{
        initMap();
    }
}
    

    
</script>